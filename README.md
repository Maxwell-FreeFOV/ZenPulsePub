# 经文念诵跟踪 Web 应用

## 项目介绍

本项目开发了一款基于 Web 的经文念诵进度跟踪应用，旨在帮助用户自动追踪念诵进度，并在前端直观显示已读和未读的经文部分。应用主要面向手机端用户，利用 Web 和 HTML5 技术，实现跨平台的便捷使用。

## 项目需求

### 功能需求

- **经文展示**：清晰展示经文内容，支持经文选择。
- **进度跟踪**：通过木鱼点击或语音识别自动跟踪念诵进度。
- **高亮显示**：已读经文和当前行使用不同颜色高亮显示。
- **跨平台支持**：确保在不同设备和浏览器上的兼容性。

### 技术需求

- **响应式设计**：适应不同屏幕尺寸的设备。
- **性能优化**：确保应用在移动设备上运行流畅。
- **音频处理**：实现实时语音识别和进度跟踪。

## 技术方案

### 前端开发

- **HTML5 + CSS3**：构建响应式用户界面。
- **JavaScript**：实现交互逻辑和音频处理。
- **Web Audio API**：捕获和处理实时音频。
- **IndexedDB**：存储用户数据和录音。

### 核心功能实现

- **经文展示**：
  - 使用 JavaScript 动态加载和分段显示经文。
  - 实现经文滚动和当前行高亮功能。

- **进度跟踪**：
  - *木鱼模式*：点击按钮手动更新进度。
  - *语音识别模式*：
    - 使用 Web Audio API 和 Meyda 库进行实时音频分析
    - 实现 VAD（Voice Activity Detection）检测
    - 自动调整到最近的句子边界
    - 使用固定阈值和动态阈值结合的方式进行音节检测

- **音频特征处理**：
  - 多特征组合判断：
    - 基础能量阈值：过滤微弱声音
    - 动态能量阈值：自适应判断
    - 能量突变检测：检测能量变化
    - 过零率：动态阈值进行判断
  - 特征归一化：
    - CMVN：消除通道效应
    - VTLN：补偿声道差异
  - 缓冲区管理：
    - 使用滑动窗口处理音频特征
    - 支持可配置的缓冲区大小
    - 实时更新特征数据

- **音节检测算法**：
  - 基础能量检查：过滤低能量信号
  - 能量水平检查：确保整体能量足够高
  - 能量突变检查：检测音节起始
  - 过零率验证：区分语音和噪声
  - 组合判断逻辑：
    - 能量水平足够高或有明显突变
    - 过零率在合理范围内
    - 实时调整判断条件

- **可视化功能**：
  - 实时波形显示：
    - 增加波形振幅显示比例
    - 更清晰的波形展示
  - 特征曲线显示：
    - MFCC曲线（绿色）
    - 能量曲线（红色）
    - 过零率曲线（蓝色）
  - VAD检测点标记：
    - 使用红色竖线标记检测点
    - 实时滚动显示

### 性能优化

- 使用 CSS transitions 实现平滑的视觉效果。
- 采用事件委托减少事件监听器数量。
- 使用 Web Worker 处理复杂计算，避免阻塞主线程。

### 跨平台兼容

- 使用响应式设计适应不同屏幕尺寸。
- 处理触摸事件，优化移动端体验。
- 进行跨浏览器测试，确保兼容性。

### 音频处理优化

- **特征提取**：
  - MFCC特征处理：
    - CMVN归一化：消除通道效应
    - VTLN归一化：补偿声道差异
  - 能量特征：
    - 固定阈值：基础噪音过滤
    - 动态阈值：自适应判断
  - 过零率分析：
    - 动态阈值计算
    - 语音/非语音判断
  - 特征缓冲：
    - 可配置的缓冲区大小
    - 滑动窗口处理
    - 实时特征更新

### 用户体验优化

- **参数调节界面**：
  - 音节检测参数：
    - 能量阈值系数：控制动态阈值灵敏度
    - 能量突变比例：控制突变检测灵敏度
  - 特征提取参数：
    - MFCC缓冲区大小：控制特征归一化窗口
    - 特征窗口大小：控制特征提取的时间跨度
  - 实时参数更新：
    - 支持实时调整所有参数
    - 立即反馈调整效果
